---
description: "Security-specific rules for PostgreSQL"
globs: ["*.sql"]
alwaysApply: false
---

<rule>
  <meta>
    <title>PostgreSQL Security Rules</title>
    <description>A rule to enforce security best practices for PostgreSQL.</description>
    <created-at utc-timestamp="1744326000">April 11, 2025, 11:00 AM AEST</created-at>
    <last-updated-at utc-timestamp="1744326000">April 11, 2025, 11:00 AM AEST</last-updated-at>
    <applies-to>
      <file-matcher glob="*.sql">All SQL files with .sql extension</file-matcher>
      <action-matcher action="sql-commit">Triggered when committing SQL changes</action-matcher>
    </applies-to>
  </meta>
  <requirements>
    <requirement priority="critical">
        <description>Never store passwords in plaintext. Use a strong hashing algorithm like bcrypt.</description>
    </requirement>
    <requirement priority="critical">
        <description>Always use parameterized queries or prepared statements to prevent SQL injection attacks.</description>
    </requirement>
    <requirement priority="critical">
        <description>Grant the least privileges necessary to database users and use roles to manage permissions.</description>
    </requirement>
    <requirement priority="high">
        <description>Regularly audit database activity.</description>
    </requirement>
    <requirement priority="high">
        <description>Encrypt sensitive data at rest and in transit.</description>
    </requirement>
    <requirement priority="medium">
        <description>Use the `SECURITY DEFINER` attribute for functions that require elevated privileges with caution.</description>
    </requirement>
    <requirement priority="high">
        <description>Configure appropriate authentication mechanisms (e.g., SCRAM-SHA-256).</description>
    </requirement>
  </requirements>
  <references>
    <reference as="dependency" href=".cursor/rules/rules.mdc" reason="Follows standard rule format">Base rule format definition</reference>
  </references>
</rule>
